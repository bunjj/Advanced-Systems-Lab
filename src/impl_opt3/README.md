Added short circuit termination for all shapes to avoid unneccessary sqrts.
Further replaced 4x4 matrices by 3x3 matrices.
